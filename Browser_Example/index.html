<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iOS风格浏览器 - 修复版</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

:root {
  --primary-color: #4285f4;
  --accent-color: #ea4335;
  --background-light: #f5f5f7;
  --background-dark: #1c1c1e;
  --card-light: rgba(255, 255, 255, 0.8);
  --card-dark: rgba(44, 44, 46, 0.8);
  --text-light: #1d1d1f;
  --text-dark: #f5f5f7;
  --border-light: rgba(0, 0, 0, 0.1);
  --border-dark: rgba(255, 255, 255, 0.1);
  --shadow-light: 0 8px 30px rgba(0, 0, 0, 0.05);
  --shadow-dark: 0 8px 30px rgba(0, 0, 0, 0.3);
  --blur-amount: 15px;
  --transition: all 0.3s ease;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  background: var(--background-light);
  color: var(--text-light);
  min-height: 100vh;
  transition: var(--transition);
  position: relative;
  overflow-x: hidden;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

body.dark-mode {
  background: var(--background-dark);
  color: var(--text-dark);
}

/* iOS风格模糊背景 */
.blur-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url('https://images.unsplash.com/photo-1501854140801-50d01698950b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80');
  background-size: cover;
  background-position: center;
  filter: blur(20px) brightness(0.9);
  z-index: -1;
  opacity: 0.7;
  transition: var(--transition);
}

body.dark-mode .blur-bg {
  filter: blur(20px) brightness(0.5);
}

/* 顶部工具栏 */
.toolbar {
  background: var(--card-light);
  padding: 12px 15px;
  display: flex;
  align-items: center;
  box-shadow: var(--shadow-light);
  backdrop-filter: blur(var(--blur-amount));
  position: relative;
  z-index: 10;
}

body.dark-mode .toolbar {
  background: var(--card-dark);
  box-shadow: var(--shadow-dark);
}

.nav-buttons {
  display: flex;
  gap: 8px;
}

.nav-button {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  color: var(--text-light);
  cursor: pointer;
  transition: var(--transition);
}

body.dark-mode .nav-button {
  color: var(--text-dark);
}

.nav-button:hover {
  background: rgba(0, 0, 0, 0.05);
}

body.dark-mode .nav-button:hover {
  background: rgba(255, 255, 255, 0.05);
}

.nav-button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.search-engine {
  margin: 0 10px;
  padding: 8px 12px;
  border-radius: 12px;
  border: none;
  background: var(--card-light);
  color: var(--text-light);
  box-shadow: var(--shadow-light);
  backdrop-filter: blur(var(--blur-amount));
  cursor: pointer;
  max-width: 120px;
  appearance: none;
}

body.dark-mode .search-engine {
  background: var(--card-dark);
  color: var(--text-dark);
  box-shadow: var(--shadow-dark);
}

.address-bar {
  flex-grow: 1;
  padding: 12px 20px 12px 45px;
  border-radius: 16px;
  border: none;
  background: var(--card-light);
  color: var(--text-light);
  box-shadow: var(--shadow-light);
  backdrop-filter: blur(var(--blur-amount));
  font-size: 16px;
  transition: var(--transition);
  position: relative;
}

body.dark-mode .address-bar {
  background: var(--card-dark);
  color: var(--text-dark);
  box-shadow: var(--shadow-dark);
}

.address-bar:focus {
  box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.5);
  outline: none;
}

.search-icon {
  position: absolute;
  left: 68px;
  top: 50%;
  transform: translateY(-50%);
  color: #aaa;
  font-size: 16px;
  z-index: 1;
}

.go-button {
  margin-left: 10px;
  padding: 10px 18px;
  background: var(--primary-color);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
}

.go-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(66, 133, 244, 0.4);
}

/* 内容区域 */
.content-area {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
}

.browser-window {
  width: 100%;
  height: 100%;
  border: none;
  display: block;
}

/* 新标签页内容 */
.new-tab {
  padding: 30px 20px;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow-y: auto;
}

.search-container {
  max-width: 600px;
  width: 100%;
  margin: 40px auto;
}

.search-title {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 24px;
  text-align: center;
  color: var(--primary-color);
}

.search-box {
  position: relative;
  margin-bottom: 24px;
}

.search-input {
  width: 100%;
  padding: 18px 20px 18px 55px;
  font-size: 18px;
  border-radius: 16px;
  border: none;
  outline: none;
  background: var(--card-light);
  color: var(--text-light);
  box-shadow: var(--shadow-light);
  backdrop-filter: blur(var(--blur-amount));
  transition: var(--transition);
}

body.dark-mode .search-input {
  background: var(--card-dark);
  color: var(--text-dark);
  box-shadow: var(--shadow-dark);
}

.search-input:focus {
  box-shadow: 0 0 0 4px rgba(66, 133, 244, 0.2);
}

.main-search-icon {
  position: absolute;
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
  color: #aaa;
  font-size: 20px;
}

.input-hint {
  display: block;
  text-align: center;
  font-size: 14px;
  color: #888;
  margin-top: 8px;
  opacity: 0.8;
}

.search-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 20px;
}

.search-button {
  padding: 14px 28px;
  background: var(--primary-color);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: var(--transition);
  box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
}

.search-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(66, 133, 244, 0.4);
}

.search-button.secondary {
  background: transparent;
  color: var(--text-light);
  box-shadow: var(--shadow-light);
  backdrop-filter: blur(var(--blur-amount));
  background: var(--card-light);
}

body.dark-mode .search-button.secondary {
  background: var(--card-dark);
  color: var(--text-dark);
  box-shadow: var(--shadow-dark);
}

/* 快速访问卡片 */
.quick-access {
  max-width: 600px;
  width: 100%;
  margin: 0 auto;
}

.section-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.apps-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 30px;
  }
  .app-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 16px 10px;
    border-radius: 16px;
    backdrop-filter: blur(var(--blur-amount));
    background: var(--card-light);
    box-shadow: var(--shadow-light);
    transition: var(--transition);
    cursor: pointer;
    text-decoration: none;
    color: var(--text-light);
  }

  body.dark-mode .app-card {
    background: var(--card-dark);
    box-shadow: var(--shadow-dark);
    color: var(--text-dark);
  }

  .app-card:hover {
    transform: translateY(-5px);
  }

  .app-icon {
    width: 50px;
    height: 50px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
    font-size: 24px;
    color: white;
  }

  .app-name {
    font-size: 13px;
    font-weight: 500;
    text-align: center;
  }

  /* 底部信息 */
  .footer {
    max-width: 600px;
    width: 100%;
    margin: 40px auto 0;
    padding-top: 20px;
    border-top: 1px solid var(--border-light);
    text-align: center;
    font-size: 14px;
    color: #888;
  }

  body.dark-mode .footer {
    border-top: 1px solid var(--border-dark);
  }

  .footer-links {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 15px;
    flex-wrap: wrap;
  }

  .footer-link {
    color: #888;
    text-decoration: none;
    transition: var(--transition);
  }

  .footer-link:hover {
    color: var(--primary-color);
  }

  /* 加载指示器 */
  .refresh-loading {
    display: none;
    animation: spin 1s linear infinite;
  }

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* 响应式调整 */
@media (max-width: 768px) {
    .toolbar {
      padding: 10px;
      flex-wrap: wrap;
    }

    .search-engine {
      order: 3;
      margin: 10px 0 0 0;
      max-width: 100%;
      width: 100%;
    }

    .address-bar {
      margin: 10px 0;
      padding: 10px 15px 10px 40px;
    }

    .search-icon {
      left: 25px;
    }

    .go-button {
      margin-left: 0;
      width: 100%;
      margin-top: 5px;
    }

    .apps-grid {
      grid-template-columns: repeat(3, 1fr);
      }
    }

@media (max-width: 480px) {
      .apps-grid {
        grid-template-columns: repeat(2, 1fr);
        }

        .search-title {
          font-size: 26px;
        }

        .search-buttons {
          flex-direction: column;
        }
      }
      </style>
      </head>
      <body>
      <!-- 模糊背景 -->
      <div class="blur-bg"></div>

      <!-- 顶部工具栏 -->
      <div class="toolbar">
      <div class="nav-buttons">
      <button class="nav-button" id="back" title="后退" disabled>
      <i class="fas fa-arrow-left"></i>
      </button>
      <button class="nav-button" id="forward" title="前进" disabled>
      <i class="fas fa-arrow-right"></i>
      </button>
      <button class="nav-button" id="refresh" title="刷新">
      <i class="fas fa-sync-alt" id="refresh-icon"></i>
      <i class="fas fa-circle-notch refresh-loading" id="refresh-loading"></i>
      </button>
      <button class="nav-button" id="home" title="主页">
      <i class="fas fa-home"></i>
      </button>
      <button class="nav-button" id="theme-toggle" title="切换主题">
      <i class="fas fa-moon"></i>
      </button>
      <button class="nav-button" title="退出" id="exit-button">
      <i class="fas fa-sign-out-alt"></i>
      </button>
      </div>

      <select id="search-engine" class="search-engine">
      <option value="https://www.bing.com/search?q=">Bing</option>
      <option value="https://www.baidu.com/s?wd=" selected>百度</option>
      <option value="https://m.so.com/s?q=">360搜索</option>
      </select>

      <div style="position: relative; flex-grow: 1;">
      <i class="fas fa-search search-icon"></i>
      <input type="text" class="address-bar" id="address" placeholder="输入网址或搜索内容">
      </div>

      <button class="go-button" id="go">前往</button>
      </div>

      <!-- 内容区域 -->
      <div class="content-area">
      <!-- 浏览器窗口 -->
      <iframe id="browser" class="browser-window" src="about:blank"></iframe>

      <!-- 新标签页内容 -->
      <div class="new-tab" id="new-tab">
      <div class="search-container">
      <h1 class="search-title">iOS风格浏览器</h1>
      <div class="search-box">
      <i class="fas fa-search main-search-icon"></i>
      <input type="text" class="search-input" id="main-search" placeholder="输入搜索词或网址">
      <span class="input-hint">支持文字搜索或直接输入网址跳转</span>
      </div>
      <div class="search-buttons">
      <button class="search-button" id="main-search-button">
      <i class="fas fa-search"></i>
      开始搜索
      </button>
      <button class="search-button secondary">
      <i class="fas fa-camera"></i>
      图片搜索
      </button>
      </div>
      </div>

      <div class="quick-access">
      <h2 class="section-title">
      <i class="fas fa-th-large"></i>
      快速访问
      </h2>
      <div class="apps-grid">
      <a href="#" class="app-card">
      <div class="app-icon" style="background: linear-gradient(135deg, #FF9A9E, #FAD0C4);">
      <i class="fas fa-newspaper"></i>
      </div>
      <div class="app-name">新闻</div>
      </a>
      <a href="#" class="app-card">
      <div class="app-icon" style="background: linear-gradient(135deg, #A1C4FD, #C2E9FB);">
      <i class="fas fa-map"></i>
      </div>
      <div class="app-name">地图</div>
      </a>
      <a href="#" class="app-card">
      <div class="app-icon" style="background: linear-gradient(135deg, #FFD1FF, #FAD0C4);">
      <i class="fas fa-shopping-cart"></i>
      </div>
      <div class="app-name">购物</div>
      </a>
      <a href="#" class="app-card">
      <div class="app-icon" style="background: linear-gradient(135deg, #84FAB0, #8FD3F4);">
      <i class="fas fa-video"></i>
      </div>
      <div class="app-name">视频</div>
      </a>
      <a href="#" class="app-card">
      <div class="app-icon" style="background: linear-gradient(135deg, #D4FC79, #96E6A1);">
      <i class="fas fa-image"></i>
      </div>
      <div class="app-name">图片</div>
      </a>
      <a href="#" class="app-card">
      <div class="app-icon" style="background: linear-gradient(135deg, #A6C0FE, #F68084);">
      <i class="fas fa-music"></i>
      </div>
      <div class="app-name">音乐</div>
      </a>
      <a href="#" class="app-card">
      <div class="app-icon" style="background: linear-gradient(135deg, #E0C3FC, #8EC5FC);">
      <i class="fas fa-book"></i>
      </div>
      <div class="app-name">文库</div>
      </a>
      <a href="#" class="app-card">
      <div class="app-icon" style="background: linear-gradient(135deg, #F093FB, #F5576C);">
      <i class="fas fa-cloud"></i>
      </div>
      <div class="app-name">网盘</div>
      </a>
      </div>
      </div>

      <div class="footer">
      <p>iOS风格浏览器 - 现代设计与强大功能的结合</p>
      <div class="footer-links">
      <a href="#" class="footer-link">隐私政策</a>
      <a href="#" class="footer-link">帮助中心</a>
      <a href="#" class="footer-link">意见反馈</a>
      </div>
      </div>
      </div>
      </div>
      <script>
      // DOM元素
      const browser = document.getElementById('browser');
      const addressBar = document.getElementById('address');
      const mainSearch = document.getElementById('main-search');
      const goButton = document.getElementById('go');
      const backButton = document.getElementById('back');
      const forwardButton = document.getElementById('forward');
      const refreshButton = document.getElementById('refresh');
      const refreshIcon = document.getElementById('refresh-icon');
      const refreshLoading = document.getElementById('refresh-loading');
      const homeButton = document.getElementById('home');
      const searchEngine = document.getElementById('search-engine');
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = themeToggle.querySelector('i');
      const mainSearchButton = document.getElementById('main-search-button');
      const newTab = document.getElementById('new-tab');

      // 历史记录管理
      let historyStack = [];
      let currentHistoryIndex = -1;

      // 初始状态
      let isNewTab = true;

      // 智能识别输入内容
      function isUrl(str) {
          const pattern = /^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/;
        return pattern.test(str) || (str.includes('.') && !str.includes(' '));
    }

    // 导航功能
function navigate() {
    let url = addressBar.value.trim();
    if (!url) return;

    isNewTab = false;
    newTab.style.display = 'none';
    browser.style.display = 'block';

    if (isUrl(url)) {
        if (!/^https?:\/\//i.test(url)) {
            url = 'http://' + url;
        }
    } else {
        url = searchEngine.value + encodeURIComponent(url);
    }

    // 动态设置 UA
    let ua = "Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Mobile/15E148 Safari/604.1";
    if (url.includes("bing.com") || searchEngine.value.includes("bing.com")) {
        ua = "Mozilla/5.0 (Linux; Android 13; Pixel 7 Pro Build/TQ3A.230805.001) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Mobile Safari/537.36";
    }

    // 强制刷新 UA
    if (window.lua && window.lua.setUserAgent) {
        window.lua.setUserAgent(ua);
        // 延迟加载以确保 UA 生效
        setTimeout(() => {
            console.log("Navigating to: ", url, "with UA: ", ua);
            browser.src = url;
        }, 100);
    } else {
        console.log("Navigating to: ", url, "with default UA");
        browser.src = url;
    }

    addToHistory(url);
    updateNavButtons();

    document.activeElement.blur();
    window.scrollTo(0, 0);
}

    // 从主搜索框导航
    function navigateFromMain() {
        let url = mainSearch.value.trim();
        if (!url) return;

        addressBar.value = url;
        navigate();
    }

    // 返回主页
    function goHome() {
        isNewTab = true;
        newTab.style.display = 'flex';
        browser.style.display = 'none';
        addressBar.value = '';
        mainSearch.value = '';

        // 添加到历史记录
        addToHistory('home');

        // 更新按钮状态
        updateNavButtons();
    }

    // 添加到历史记录
    function addToHistory(url) {
        // 移除当前位置之后的所有历史记录
        if (currentHistoryIndex < historyStack.length - 1) {
            historyStack = historyStack.slice(0, currentHistoryIndex + 1);
        }

        // 添加新记录
        historyStack.push(url);
        currentHistoryIndex = historyStack.length - 1;

        // 更新浏览器历史记录
        window.history.pushState({ index: currentHistoryIndex }, '');
    }

    // 更新导航按钮状态
    function updateNavButtons() {
        backButton.disabled = currentHistoryIndex <= 0;
        forwardButton.disabled = currentHistoryIndex >= historyStack.length - 1;
    }

    // 导航到历史记录中的特定位置
    function goToHistory(index) {
        if (index < 0 || index >= historyStack.length) return;

        currentHistoryIndex = index;
        const url = historyStack[index];

        if (url === 'home') {
            isNewTab = true;
            newTab.style.display = 'flex';
            browser.style.display = 'none';
            addressBar.value = '';
            mainSearch.value = '';
        } else {
            isNewTab = false;
            newTab.style.display = 'none';
            browser.style.display = 'block';
            browser.src = url;
            addressBar.value = url;
        }

        updateNavButtons();
    }

    // 刷新功能
    function refreshPage() {
        if (isNewTab) {
            // 在新标签页时，重新加载快速访问内容
            const event = new Event('refreshNewTab');
            window.dispatchEvent(event);
            showNotification('已刷新新标签页');
        } else {
            // 显示加载动画
            refreshIcon.style.display = 'none';
            refreshLoading.style.display = 'block';

            // 重新加载iframe内容
            browser.src = browser.src;

            // 监听iframe加载完成
            browser.addEventListener('load', function onLoad() {
                // 隐藏加载动画
                refreshIcon.style.display = 'block';
                refreshLoading.style.display = 'none';

                // 移除事件监听器
                browser.removeEventListener('load', onLoad);
            });
        }
    }

    // 显示通知
    function showNotification(message) {
        // 移除旧的通知
        const oldNotification = document.querySelector('.notification');
        if (oldNotification) {
            oldNotification.remove();
        }

        // 创建新通知
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: fadeInOut 2s ease-in-out;
        `;
        // 添加样式
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translate(-50%, -20px); }
                10% { opacity: 1; transform: translate(-50%, 0); }
                90% { opacity: 1; transform: translate(-50%, 0); }
                100% { opacity: 0; transform: translate(-50%, -20px); }
            }
        `;
        document.head.appendChild(style);

        document.body.appendChild(notification);

        // 2秒后移除通知
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 2000);
    }

    // 事件监听
    goButton.addEventListener('click', navigate);
    addressBar.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            navigate();
            document.activeElement.blur();
            window.scrollTo(0, 0);
        }
    });

    mainSearchButton.addEventListener('click', navigateFromMain);
    mainSearch.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            navigateFromMain();
            document.activeElement.blur();
            window.scrollTo(0, 0);
        }
    });

    homeButton.addEventListener('click', goHome);

    backButton.addEventListener('click', () => {
        if (currentHistoryIndex > 0) {
            goToHistory(currentHistoryIndex - 1);
        }
    });

    forwardButton.addEventListener('click', () => {
        if (currentHistoryIndex < historyStack.length - 1) {
            goToHistory(currentHistoryIndex + 1);
        }
    });

    refreshButton.addEventListener('click', refreshPage);

    // 监听iframe的URL变化
    browser.addEventListener('load', function() {
        let currentUrl;
        try {
            // 尝试获取iframe的实际URL（防跨域）
            if (browser.contentWindow.location.href !== 'about:blank') {
                currentUrl = browser.contentWindow.location.href;
                addressBar.value = currentUrl;
            } else {
                currentUrl = addressBar.value;  // fallback到已设置的值
            }
        } catch (e) {
            // 跨域时，用addressBar.value（从Lua注入设置）
            currentUrl = addressBar.value;
        }

        // 如果当前不是新标签页，且URL有效且不同于当前历史顶端，则添加历史
        if (!isNewTab && currentUrl && currentUrl !== historyStack[currentHistoryIndex]) {
            addToHistory(currentUrl);
            // 更新导航按钮
            updateNavButtons();
        }
    });

    // 主题切换功能
    themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');

        if (document.body.classList.contains('dark-mode')) {
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
        } else {
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
        }

        // 保存主题偏好
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    });

    // 处理浏览器前进后退按钮
    window.addEventListener('popstate', function(event) {
        // 从历史记录中获取状态
        if (event.state && event.state.index !== undefined) {
            goToHistory(event.state.index);
        }
    });

    // 添加示例搜索词
    const sampleQueries = ['人工智能发展', '2023年科技趋势', 'apple.com', 'github.com'];
    let sampleIndex = 0;

    function rotateSampleQuery() {
        if (isNewTab) {
            mainSearch.placeholder = `输入搜索词或网址，例如: ${sampleQueries[sampleIndex]}`;
        }
        addressBar.placeholder = `输入网址或搜索内容，例如: ${sampleQueries[sampleIndex]}`;
        sampleIndex = (sampleIndex + 1) % sampleQueries.length;
    }

    // 初始设置和轮换
    rotateSampleQuery();
    setInterval(rotateSampleQuery, 3000);

    // 初始显示新标签页
    goHome();

    // 检查保存的主题偏好
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        themeIcon.classList.remove('fa-moon');
        themeIcon.classList.add('fa-sun');
    }

    // 监听新标签页刷新事件
    window.addEventListener('refreshNewTab', function() {
        console.log('刷新新标签页');
    });

    // 退出按钮
    const exitButton = document.getElementById('exit-button');
    exitButton.addEventListener('click', () => {
        if (window.lua && window.lua.exitApp) {
            window.lua.exitApp();
        }
    });
</script>
</body>
</html>

